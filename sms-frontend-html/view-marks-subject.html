<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Marks by Subject</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="content-wrapper">
  <h2>üìò View Marks by Subject</h2>

  <label>Class:</label>
  <select id="classSelect">
    <option value="">-- Select Class --</option>
    <option value="TYCS">TYCS</option>
    <option value="SYCS">SYCS</option>
    <option value="FYCS">FYCS</option>
  </select>

  <label>Subject:</label>
  <input type="text" id="subjectInput" placeholder="Enter subject" />

  <label>Date:</label>
  <input type="date" id="dateInput" />

  <button onclick="loadSubjectMarks()">üîç View Marks</button>

  <div id="marksDisplay" style="margin-top: 20px;"></div>

  <script>
    async function loadSubjectMarks() {
      const className = document.getElementById("classSelect").value.trim();
      const subject = document.getElementById("subjectInput").value.trim();
      const date = document.getElementById("dateInput").value.trim();

      if (!className || !subject || !date) {
        alert("Please fill all fields.");
        return;
      }

      const res = await fetch(`/api/subject-marks?class=${className}&subject=${subject}&date=${date}`);
      const result = await res.json();

      const container = document.getElementById("marksDisplay");
      container.innerHTML = "";

      if (!result.success || result.marks.length === 0) {
        container.innerHTML = "<p>‚ö†Ô∏è No marks found for this test.</p>";
        return;
      }

      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>Student ID</th>
          <th>Name</th>
          <th>Marks</th>
          <th>Max Marks</th>
        </tr>
      `;

      result.marks.forEach(m => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${m.student_id}</td>
          <td>${m.name}</td>
          <td>${m.marks}</td>
          <td>${m.max_marks}</td>
        `;
        table.appendChild(row);
      });

      const analytics = result.analytics;
      const summary = document.createElement("div");
      summary.innerHTML = `
        <h3>üìä Class Analytics</h3>
        <p>Average Marks: ${analytics.average}</p>
        <p>Highest Marks: ${analytics.highest}</p>
        <p>Lowest Marks: ${analytics.lowest}</p>
      `;

      container.appendChild(table);
      container.appendChild(summary);
    }
  </script>
  </div>
</body>
</html>