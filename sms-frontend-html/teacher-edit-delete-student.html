<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‚úèÔ∏è Teacher Edit/Delete Student</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .search-toggle {
      display: flex;
      gap: 30px;
      justify-content: center;
      margin-bottom: 10px;
    }
    .student-result {
      margin-top: 20px;
      padding: 10px;
      background-color: #f3e5f5;
      border-radius: 8px;
    }
    .edit-form {
      margin-top: 20px;
    }
    .edit-form input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="site-title">‚úèÔ∏è Edit/Delete Student</div>
  <div class="login-wrapper">
    <div class="login-container">
      <div class="search-toggle">
        <label><input type="radio" name="searchType" value="id" checked> Search by ID</label>
        <label><input type="radio" name="searchType" value="name"> Search by Name</label>
      </div>

      <input type="text" id="searchInput" placeholder="Enter ID or Name">
      <button onclick="searchStudent()">Search</button>

      <div id="result" class="student-result"></div>
      <div id="editForm" class="edit-form" style="display:none;"></div>
    </div>
  </div>
<script>
  let currentStudent = null;
  const admin_id = localStorage.getItem("admin_id"); // ‚úÖ Inject admin_id

  async function searchStudent() {
    const query = document.getElementById("searchInput").value.trim();
    const type = document.querySelector('input[name="searchType"]:checked').value;
    const resultBox = document.getElementById("result");
    const editBox = document.getElementById("editForm");

    resultBox.innerHTML = "";
    editBox.style.display = "none";
    currentStudent = null;

    const res = await fetch("http://localhost:5000/api/search-student", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type, query, admin_id }) // ‚úÖ Include admin_id
    });

    const data = await res.json();
    if (!data.success || !data.student) {
      resultBox.textContent = "‚ùå Student not found.";
      return;
    }

    currentStudent = data.student;
    const s = currentStudent;
    resultBox.innerHTML = `
      <strong>üéì Student Found:</strong><br>
      ID: ${s.id}<br>
      Name: ${s.name}<br>
      Class: ${s.class}<br>
      Email: ${s.email}<br><br>
      <button onclick="showEditForm()">‚úèÔ∏è Edit</button>
      <button onclick="confirmDelete()">üóëÔ∏è Delete</button>
    `;
  }

  function showEditForm() {
    const s = currentStudent;
    const editBox = document.getElementById("editForm");
    editBox.style.display = "block";
    editBox.innerHTML = `
      <h3>Edit Student</h3>
      <input type="text" id="editName" value="${s.name}" placeholder="Name"><br>
      <input type="text" id="editClass" value="${s.class}" placeholder="Class"><br>
      <input type="email" id="editEmail" value="${s.email}" placeholder="Email"><br>
      <button onclick="submitEdit()">‚úÖ Confirm Edit</button>
    `;
  }

  async function submitEdit() {
    const updated = {
      id: currentStudent.id,
      name: document.getElementById("editName").value.trim(),
      class: document.getElementById("editClass").value.trim(),
      email: document.getElementById("editEmail").value.trim().toLowerCase(),
      admin_id // ‚úÖ Include admin_id
    };

    const res = await fetch("http://localhost:5000/api/edit-student", {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(updated)
    });

    const data = await res.json();
    document.getElementById("result").textContent = data.message;
    document.getElementById("editForm").style.display = "none";
  }

  async function confirmDelete() {
    if (!confirm("‚ö†Ô∏è Are you sure you want to delete this student?")) return;

    const res = await fetch("http://localhost:5000/api/delete-student", {
      method: "DELETE",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id: currentStudent.id, admin_id }) // ‚úÖ Include admin_id
    });

    const data = await res.json();
    document.getElementById("result").textContent = data.message;
    document.getElementById("editForm").style.display = "none";
  }
</script>
</body>
</html>